[{"name":"/Main","nodes":[{"id":"68b43154-0fd0-e555-4250-eccb8f5e5de0","type":"Page","parameters":{"title":"main"},"ports":[],"children":[{"id":"0b0f87dd-6a10-a676-ebb0-1a89f63a5143","type":"/#Global visual components/Header nav bar","parameters":{},"ports":[],"children":[]},{"id":"9fd9c0e7-5228-af8d-80a7-a02bf219b3af","type":"Group","parameters":{"paddingTop":{"value":20,"unit":"px"},"paddingLeft":{"value":20,"unit":"px"},"paddingRight":{"value":20,"unit":"px"},"paddingBottom":{"value":20,"unit":"px"},"rowGap":{"value":20,"unit":"px"}},"ports":[],"children":[{"id":"6e31b6ee-e872-8886-4a53-639b63c3e3cd","type":"Group","parameters":{"sizeMode":"contentHeight","flexDirection":"row","columnGap":{"value":20,"unit":"px"},"flexWrap":"wrap","rowGap":{"value":10,"unit":"px"},"clip":false,"width":{"value":100,"unit":"%","isFixed":false}},"ports":[],"children":[{"id":"41252a8d-affe-3aea-bac4-069a0729523c","type":"net.noodl.controls.options","parameters":{"label":"Select a theme","items":"[\n    {\"Label\":\"Dinosaur\", \"Value\":\"dinosaur\"},\n    {\"Label\":\"Princess\", \"Value\":\"princess\"},\n    {\"Label\":\"Astronaut\", \"Value\":\"astronaut\"},\n    {\"Label\":\"Rock & Roll Girl\", \"Value\":\"rockGirl\"},\n    {\"Label\":\"Animal\", \"Value\":\"animal\"},\n    {\"Label\":\"Ninja\", \"Value\":\"ninja\"},\n    {\"Label\":\"Unicorn\", \"Value\":\"unicorn\"},\n    {\"Label\":\"Fire truck\", \"Value\":\"fireTruck\"}\n]","sizeMode":"explicit","labeltextStyle":"Label Medium","minWidth":{"value":200,"unit":"px"},"width":{"value":30,"unit":"%"}},"ports":[],"children":[]},{"id":"4275f672-1908-1d33-4eab-9629a3d86a17","type":"Group","parameters":{"maxWidth":{"value":200,"unit":"px"},"minWidth":{"value":150,"unit":"px"},"sizeMode":"explicit","height":{"value":60,"unit":"px"}},"ports":[],"children":[{"id":"6ecdd8ce-5c93-3d32-eff4-7100347410fd","type":"net.noodl.controls.textinput","parameters":{"label":"Select a label colour","placeholder":"#FFE6D5","startValue":"#FFE6D5","enabled":false,"position":"absolute"},"stateParameters":{"disabled":{"backgroundColor":"White","borderColor":"Grey - 900","textStyle":"Label Large","color":"Grey - 900","labeltextStyle":"Label Medium","labelcolor":"Grey - 900"}},"ports":[],"children":[]},{"id":"e696c016-3d2b-a3fd-2ce9-e5bb2ef7e32d","type":"Group","parameters":{"position":"absolute","zIndex":2},"ports":[],"children":[]},{"id":"bb83407a-428d-76fa-8e22-0a292e9ffe98","type":"/#Global visual components/Context menu","parameters":{"items":"[\n    {\n        \"label\": \"Beige\",\n        \"value\": \"#FFE6D5\"\n    },\n    {\n        \"label\": \"Blue\",\n        \"value\": \"#B3E5FC\"\n    },\n    {\n        \"label\": \"Green\",\n        \"value\": \"#B2F2BB\"\n    },\n    {\n        \"label\": \"Pink\",\n        \"value\": \"#FFB6C1\"\n    },\n    {\n        \"label\": \"Purple\",\n        \"value\": \"#E6E6FA\"\n    },\n    {\n        \"label\": \"Yellow\",\n        \"value\": \"#FFFACD\"\n    }\n]","offsetTop":{"value":60,"unit":"px"},"offsetLeft":{"value":0,"unit":"px"},"alignX":"left"},"ports":[],"children":[]}]},{"id":"58059581-3964-407f-86d0-4dbbf7729b80","type":"net.noodl.controls.textinput","parameters":{"label":"Enter your child's name","labeltextStyle":"Label Medium","sizeMode":"explicit","minWidth":{"value":200,"unit":"px"},"width":{"value":30,"unit":"%"}},"ports":[],"children":[]}]},{"id":"9dc23cf7-aa3d-b43b-8549-d850be358080","type":"net.noodl.controls.button","variant":"Primary button","parameters":{"label":"Generate label","backgroundColor":"Primary"},"stateParameters":{"disabled":{"backgroundColor":"Grey - 400"}},"ports":[],"children":[]},{"id":"0e7365ab-0e07-db59-c682-6a524a1f611d","type":"Group","parameters":{"rowGap":{"value":20,"unit":"px"}},"ports":[],"children":[{"id":"9be64fbe-adb5-eb02-e97c-3a8b881fe95a","type":"Text","parameters":{"text":"Label preview","textStyle":"Title Medium"},"ports":[],"children":[]},{"id":"390d8824-75e0-aca4-200b-6fd23819be3f","type":"Group","parameters":{"flexDirection":"row","height":{"value":180,"unit":"px"}},"ports":[],"children":[{"id":"1bc51c2e-7686-6758-4413-0a84cbe1af92","type":"Group","parameters":{"flexDirection":"column","sizeMode":"explicit","height":{"value":180,"unit":"px"}},"ports":[],"children":[{"id":"7aadf217-019d-726c-45bf-8f6d258e8087","type":"Group","parameters":{"flexDirection":"row","sizeMode":"contentHeight"},"ports":[],"children":[]},{"id":"e7b77823-ffee-11bc-29d3-9503dcaa22fe","type":"Group","parameters":{"width":{"value":500,"unit":"px"},"height":{"value":100,"unit":"px"}},"ports":[],"children":[]}]}]},{"id":"2c405be8-0bb4-6a0b-ea83-eda0eba24f68","type":"Group","parameters":{"flexDirection":"row","columnGap":{"value":40,"unit":"px"}},"ports":[],"children":[{"id":"6096bec8-b19c-fb14-238a-e061fe8e59d3","type":"net.noodl.controls.button","parameters":{"label":"Accept"},"ports":[],"children":[]},{"id":"a713fcc7-01f3-6c13-c52a-1b6e1e318986","type":"net.noodl.controls.button","parameters":{"label":"Try again"},"ports":[],"children":[]}]}]},{"id":"ebe14440-e408-64d8-175a-4fa6d3965797","type":"Group","parameters":{"rowGap":{"value":20,"unit":"px"}},"ports":[],"children":[{"id":"e9618216-96f1-d8fb-b27d-2d1ee45a4003","type":"Group","parameters":{"flexDirection":"row","columnGap":{"value":20,"unit":"px"}},"ports":[],"children":[{"id":"2d3b41e4-8411-3722-c00b-2fef8cbed848","type":"Group","parameters":{"borderBottomStyle":"solid","borderBottomColor":"Primary","sizeMode":"contentSize","styleCss":"/* background-color: red; */\ncursor: pointer;","borderBottomWidth":{"value":4,"unit":"px"}},"ports":[],"children":[{"id":"09e3a254-b2ec-08f5-7f9d-053056780005","type":"Text","parameters":{"text":"Community labels","textStyle":"Title Medium","sizeMode":"contentHeight"},"ports":[],"children":[]}]},{"id":"953c52fc-32c5-557a-6d45-b03766b2c0d6","type":"Group","parameters":{"borderBottomStyle":"solid","borderBottomColor":"Primary","sizeMode":"contentSize","styleCss":"/* background-color: red; */\ncursor: pointer;","borderBottomWidth":{"value":4,"unit":"px"}},"ports":[],"children":[{"id":"367f2ab2-b008-d0d8-59fb-6ad20f329399","type":"Text","parameters":{"text":"My labels","textStyle":"Title Medium","sizeMode":"contentHeight"},"ports":[],"children":[]}]}]},{"id":"5b3b2cfe-1fed-6e5d-e720-d7e878e963e8","type":"net.noodl.visual.columns","parameters":{"layoutString":"1 1 1 1 1 1 1","minWidth":{"value":600,"unit":"px"}},"ports":[],"children":[{"id":"d4ad2569-b906-6790-31e0-023316f5ef5c","type":"For Each","parameters":{"template":"/Main/label item"},"ports":[],"children":[]}]}]}]}]},{"id":"bf402fbb-5498-7f7a-9149-5b45ad627a88","type":"PageInputs","parameters":{},"ports":[],"children":[]},{"id":"e268b984-e125-b4a6-c6bc-33d993b77383","type":"net.noodl.user.User","parameters":{},"ports":[],"children":[]},{"id":"2126f86d-df30-2742-a678-abdbbbea502f","type":"Expression","parameters":{"expression":"Verified!==true"},"ports":[],"children":[]},{"id":"faddb52c-1822-529c-bb28-82942a02434f","type":"net.noodl.user.User","parameters":{},"ports":[],"children":[]},{"id":"2562d44e-4100-8b6e-6b03-203dd9490c50","type":"RouterNavigate","parameters":{"router":"Main","target":"/Log In"},"ports":[],"children":[]},{"id":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","type":"/Main/n8n get AI image","parameters":{},"ports":[],"children":[]},{"id":"75de0e48-2cfc-16fd-4e90-e96be436e5b0","type":"Expression","parameters":{"expression":"results.data[0].url\n"},"ports":[],"children":[]},{"id":"7d757882-a9c6-0e72-aaf1-d32452cf4815","type":"JavaScriptFunction","parameters":{"functionScript":"if (!Inputs.imageUrl) return;\n\nconst img = new Image();\nimg.src = Inputs.imageUrl;\nimg.onload = function() {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    \n    canvas.width = img.width;\n    canvas.height = img.height;\n    ctx.drawImage(img, 0, 0);\n    \n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    const data = imageData.data;\n    \n    // Function to check if a color is within the background range\n    function isBackground(r, g, b) {\n        const brightness = (r + g + b) / 3;\n        const maxColorDiff = Math.max(Math.abs(r - g), Math.abs(r - b), Math.abs(g - b));\n        \n        // Adjust these values based on your specific images\n        return brightness > 200 && maxColorDiff < 30;\n    }\n    \n    // Flood fill algorithm\n    function floodFill(x, y) {\n        const stack = [[x, y]];\n        const width = canvas.width;\n        const height = canvas.height;\n        \n        while (stack.length) {\n            const [x, y] = stack.pop();\n            const index = (y * width + x) * 4;\n            \n            if (x < 0 || x >= width || y < 0 || y >= height) continue;\n            if (data[index + 3] === 0) continue; // Already processed\n            \n            const r = data[index];\n            const g = data[index + 1];\n            const b = data[index + 2];\n            \n            if (!isBackground(r, g, b)) continue;\n            \n            // Set pixel to transparent\n            data[index + 3] = 0;\n            \n            // Add neighboring pixels to stack\n            stack.push([x + 1, y], [x - 1, y], [x, y + 1], [x, y - 1]);\n        }\n    }\n    \n    // Start flood fill from all four corners\n    floodFill(0, 0);\n    floodFill(canvas.width - 1, 0);\n    floodFill(0, canvas.height - 1);\n    floodFill(canvas.width - 1, canvas.height - 1);\n    \n    ctx.putImageData(imageData, 0, 0);\n    \n    const pngUrl = canvas.toDataURL('image/png');\n    Outputs.pngUrl = pngUrl;\n    Outputs.Success();\n};"},"ports":[{"name":"in-imageUrl","displayName":"imageUrl","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-pngUrl","displayName":"pngUrl","plug":"output","type":"*","group":"Outputs","index":6}],"children":[]},{"id":"3813ae8c-be44-a6d6-ed79-61c046e24603","type":"JavaScriptFunction","parameters":{"functionScript":"const fabricUniqueId = '--fabric-js--';\nconst fabricScriptUrl = `https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js`;\n\nfunction injectFabricScript(onload) {\n    if (!document.querySelector(`#${fabricUniqueId}`)) {\n        const script = document.createElement('script');\n        script.id = fabricUniqueId;\n        script.src = fabricScriptUrl;\n        script.onload = () => {\n            console.log('Fabric.js loaded successfully');\n            onload();\n        };\n        script.onerror = () => {\n            console.error('Failed to load Fabric.js');\n        };\n        document.head.appendChild(script);\n    } else {\n        console.log('Fabric.js already loaded');\n        onload();\n    }\n}\n\ninjectFabricScript(() => {\n    Outputs.Loaded();\n});\n"},"ports":[{"name":"out-Loaded","displayName":"Loaded","plug":"output","type":"signal","group":"Outputs","index":4}],"children":[]},{"id":"319d7186-a007-008c-4abc-21ffdeb2e4e6","type":"Javascript2","parameters":{"code":"let canvas = null;\n\n// Font loading function\nfunction loadFont(fontName, fontUrl) {\n    const font = new FontFace(fontName, `url(${fontUrl})`);\n    font.load().then((loadedFont) => {\n        document.fonts.add(loadedFont);\n        console.log(`Font ${fontName} loaded successfully`);\n        // Refresh the canvas to apply the new font\n        if (canvas) {\n            canvas.renderAll();\n        }\n    }).catch((error) => {\n        console.error(`Error loading font ${fontName}:`, error);\n    });\n}\n\nScript.Signals.Setup = function () {\n    const element = Script.Inputs.This.getDOMElement();\n    console.log('Element received:', element);\n\n    if (!element) {\n        console.error('No element received from This input');\n        return;\n    }\n\n    if (!element.querySelector('canvas')) {\n        const canvasElement = document.createElement('canvas');\n        canvasElement.id = 'fabricCanvas';\n        canvasElement.width = Script.Inputs.CanvasWidth || 600;\n        canvasElement.height = Script.Inputs.CanvasHeight || 160;\n        element.appendChild(canvasElement);\n        console.log('Canvas element created and appended');\n    }\n\n    const canvasElement = element.querySelector('canvas');\n    console.log('Canvas element:', canvasElement);\n\n    if (!canvasElement) {\n        console.error('Canvas element could not be found');\n        return;\n    }\n\n    try {\n        canvas = new fabric.Canvas(canvasElement);\n        console.log('Fabric.js canvas initialized:', canvas);\n\n        // Add rounded corners\n        const radius = Script.Inputs.CornerRadius || 20; // default corner radius of 20px\n        const rect = new fabric.Rect({\n            width: canvas.width,\n            height: canvas.height,\n            rx: radius,\n            ry: radius,\n            fill: 'transparent'\n        });\n        canvas.clipPath = rect;\n\n        // Check if a background color is provided, and only set the default if none is provided\n        const defaultBackgroundColor = \"#FFE6D5\";  // Soft peach\n        const bgColor = Script.Inputs.BackgroundColor || defaultBackgroundColor;\n        canvas.setBackgroundColor(bgColor, canvas.renderAll.bind(canvas));\n        canvas.initialBackgroundColor = bgColor;\n\n    } catch (error) {\n        console.error('Failed to initialize Fabric.js canvas:', error);\n    }\n\n    // Load the Fredoka font\n    loadFont('Fredoka', '/fonts/Fredoka/static/Fredoka-Regular.ttf');\n\n    Script.Outputs.CanvasReady();\n};\n\n// Updated signal to add text with specific positioning and alignment\nScript.Signals.AddText = function () {\n    if (canvas) {\n        const textAreaWidth = 400; // 600px - 200px\n        const text = new fabric.Textbox(Script.Inputs.Text || 'Editable Text', {\n            left: 140,\n            top: 50, // You can adjust this value as needed\n            width: textAreaWidth,\n            fontFamily: Script.Inputs.FontFamily || 'Fredoka, sans-serif', // Set Fredoka as default\n            fontSize: Script.Inputs.FontSize || 80,\n            fill: Script.Inputs.TextColor || 'black',\n            textAlign: 'center',\n            originX: 'left',\n            originY: 'top',\n            // Adding options to make canvas additions static. This should be revised later in future versions\n            selectable: false,   // Make the text static\n            hasControls: false,  // Disable controls for resizing or rotating\n            evented: false       // Disable interaction events\n        });\n\n        // Center the text vertically within the canvas\n        text.top = (canvas.height - text.height) / 2;\n\n        canvas.add(text);\n        canvas.renderAll();\n        console.log('Text added to canvas:', text);\n    }\n};\n\n// Updated signal to add an image from a URL with resizing\nScript.Signals.AddImageFromUrl = function () {\n    const imageUrl = Script.Inputs.ImageUrl;\n    console.log('Adding image from URL:', imageUrl);\n\n    if (canvas && imageUrl) {\n        fabric.Image.fromURL(imageUrl, function (img) {\n            // Calculate scaling factor to fit height to 200px max\n            const scaleFactor = 160 / img.height;\n            \n            // Only scale down, not up\n            if (scaleFactor < 1) {\n                img.scale(scaleFactor);\n            }\n\n            canvas.add(img);\n            canvas.renderAll();\n            console.log('Image added to canvas:', img);\n        }, { \n            crossOrigin: 'anonymous',\n        });\n    }\n};\n\n// Updated signal to export the canvas as an image file\nScript.Signals.ExportAsImage = function () {\n    if (canvas) {\n        const imageData = canvas.toDataURL({\n            format: 'png',\n            quality: 1\n        });\n\n        // Convert base64 to blob\n        const byteString = atob(imageData.split(',')[1]);\n        const mimeString = imageData.split(',')[0].split(':')[1].split(';')[0];\n        const ab = new ArrayBuffer(byteString.length);\n        const ia = new Uint8Array(ab);\n        for (let i = 0; i < byteString.length; i++) {\n            ia[i] = byteString.charCodeAt(i);\n        }\n        const blob = new Blob([ab], {type: mimeString});\n\n        // Create a File object\n        const fileName = 'canvas_export.png';\n        const file = new File([blob], fileName, {type: 'image/png'});\n\n        Script.Outputs.ImageFile = file;\n        Script.Outputs.ImageExported();\n        console.log('Canvas exported as image file:', fileName);\n    }\n};\n\n// New signal to reset the canvas\nScript.Signals.ResetCanvas = function () {\n    if (canvas) {\n        // Clear all objects from the canvas\n        canvas.clear();\n        \n        // Reapply the background color if it was set\n        if (Script.Inputs.BackgroundColor) {\n            canvas.setBackgroundColor(Script.Inputs.BackgroundColor, canvas.renderAll.bind(canvas));\n        }\n        \n        canvas.renderAll();\n        console.log('Canvas reset: All objects removed');\n    } else {\n        console.log('Canvas not initialized, unable to reset');\n    }\n};\n\n// Cleanup when the node is unmounted\nScript.OnDestroy = function () {\n    if (canvas) {\n        canvas.dispose();\n        canvas = null;\n        console.log('Canvas disposed');\n    }\n};\n\nScript.Signals.DeleteSelectedObject = function () {\n    if (canvas) {\n        const activeObject = canvas.getActiveObject();\n        if (activeObject) {\n            canvas.remove(activeObject);\n            canvas.renderAll();\n            console.log('Selected object deleted:', activeObject);\n        } else {\n            console.log('No object selected to delete');\n        }\n    }\n};\n\n// New signal to set the background color\nScript.Signals.SetBackgroundColor = function () {\n    if (canvas) {\n        const color = Script.Inputs.colour;\n        if (color) {\n            canvas.setBackgroundColor(color, canvas.renderAll.bind(canvas));\n            console.log('Canvas background color set to:', color);\n        } else {\n            console.log('No color specified for background');\n        }\n    }\n};"},"ports":[{"name":"Setup","plug":"input","type":{"name":"signal"},"group":"Inputs","index":5},{"name":"AddText","plug":"input","type":{"name":"signal"},"group":"Inputs","index":6},{"name":"AddImageFromUrl","plug":"input","type":{"name":"signal"},"group":"Inputs","index":7},{"name":"ExportAsImage","plug":"input","type":{"name":"signal"},"group":"Inputs","index":8},{"name":"ResetCanvas","plug":"input","type":{"name":"signal"},"group":"Inputs","index":9},{"name":"DeleteSelectedObject","plug":"input","type":{"name":"signal"},"group":"Inputs","index":10},{"name":"SetBackgroundColor","plug":"input","type":{"name":"signal"},"group":"Inputs","index":11},{"name":"This","displayName":"This","plug":"input","type":"*","group":"Inputs","index":12},{"name":"CanvasWidth","displayName":"CanvasWidth","plug":"input","type":"*","group":"Inputs","index":13},{"name":"CanvasHeight","displayName":"CanvasHeight","plug":"input","type":"*","group":"Inputs","index":14},{"name":"CornerRadius","displayName":"CornerRadius","plug":"input","type":"*","group":"Inputs","index":15},{"name":"BackgroundColor","displayName":"BackgroundColor","plug":"input","type":"*","group":"Inputs","index":16},{"name":"Text","displayName":"Text","plug":"input","type":"*","group":"Inputs","index":17},{"name":"FontFamily","displayName":"FontFamily","plug":"input","type":"*","group":"Inputs","index":18},{"name":"FontSize","displayName":"FontSize","plug":"input","type":"*","group":"Inputs","index":19},{"name":"TextColor","displayName":"TextColor","plug":"input","type":"*","group":"Inputs","index":20},{"name":"ImageUrl","displayName":"ImageUrl","plug":"input","type":"*","group":"Inputs","index":21},{"name":"colour","displayName":"colour","plug":"input","type":"*","group":"Inputs","index":22},{"name":"CanvasReady","displayName":"CanvasReady","plug":"output","type":"signal","group":"Outputs","index":23},{"name":"ImageExported","displayName":"ImageExported","plug":"output","type":"signal","group":"Outputs","index":24},{"name":"ImageFile","displayName":"ImageFile","plug":"output","type":"*","group":"Outputs","index":25}],"children":[]},{"id":"fa1a59d5-33bf-85c1-dc3f-5f58fb370b82","type":"Expression","parameters":{"expression":"theme && name"},"ports":[],"children":[]},{"id":"e3e7c59c-7607-8f9f-77be-b06276e889b8","type":"NavigationShowPopup","parameters":{"target":"/Main/Loading popup"},"ports":[],"children":[]},{"id":"dd15fa59-dbe6-9e70-3ee9-054bf45d9ef2","type":"Event Sender","parameters":{"channelName":"aiComplete"},"ports":[],"children":[]},{"id":"1c01d3e5-d815-5cdc-de34-79d841bf6e67","type":"NewDbModelProperties","parameters":{"collectionName":"Label","prop-community":true},"ports":[],"children":[]},{"id":"e62a9624-4559-b212-8ba9-d1c6a0056c1c","type":"Upload File","parameters":{},"ports":[],"children":[]},{"id":"f006d435-0dde-564c-ec14-a00690f1fddc","type":"net.noodl.user.User","parameters":{},"ports":[],"children":[]},{"id":"41e5e30f-416f-0ec7-10ff-3819f1f54a55","type":"Timer","parameters":{"duration":1000},"ports":[],"children":[]},{"id":"c548e536-4117-8e5f-1b3c-ec57591a3373","type":"States","parameters":{"states":"community,mine","values":"communityBottomBorder,myBottomBorder","type-communityBottomBorder":"color","value-community-communityBottomBorder":"Primary","value-mine-communityBottomBorder":"transparent","value-community-myBottomBorder":"transparent","value-mine-myBottomBorder":"Primary","type-myBottomBorder":"color"},"ports":[],"children":[]},{"id":"9b2e4cb5-3f48-f70b-6907-7f836376b0c8","type":"Collection2","parameters":{"collectionId":"allLabels"},"ports":[],"children":[]},{"id":"bc7bb39a-7cd1-6f70-6e62-c11005df965c","type":"Collection2","parameters":{"collectionId":"myLabels"},"ports":[],"children":[]},{"id":"9e4510bf-a0e0-3982-f1f0-9c331bb148bf","type":"JavaScriptFunction","parameters":{"functionScript":"const allLabels = Inputs.allLabels;\nconst myLabels = Inputs.myLabels;\n\nswitch (Inputs.tab) {\n    case \"community\":\n    Outputs.array = allLabels;\n    break;\n\n    case \"mine\":\n    Outputs.array = myLabels;\n    break;\n}"},"ports":[{"name":"in-allLabels","displayName":"allLabels","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-myLabels","displayName":"myLabels","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-tab","displayName":"tab","plug":"input","type":"*","group":"Inputs","index":6},{"name":"out-array","displayName":"array","plug":"output","type":"*","group":"Outputs","index":7}],"children":[]},{"id":"ed5eb6df-57fd-0d40-a624-77d27cd30a58","type":"Expression","parameters":{"expression":"imageUrl != \"\""},"ports":[],"children":[]},{"id":"728a7068-e1bb-0a33-cab8-3f1e2f35db90","type":"States","parameters":{"states":"#FFE6D5,#B3E5FC,#B2F2BB,#FFB6C1,#E6E6FA,#FFFACD","values":"colour","type-colour":"color","useTransitions":true,"value-#FFE6D5-colour":"#FFE6D5","value-#B2F2BB-colour":"#B2F2BB","value-#FFB6C1-colour":"#FFB6C1","value-#E6E6FA-colour":"#E6E6FA","value-#FFFACD-colour":"#FFFACD","value-#B3E5FC-colour":"#B3E5FC"},"ports":[],"children":[]},{"id":"e5fac525-9fcb-7401-8079-c8e48fbce6b9","type":"Filter Collection","parameters":{"filterFilter":"community","filterFilterType-community":"boolean","filterFilterValue-community":true},"ports":[],"children":[]},{"id":"0802b6e9-e8fd-6e12-4fa7-a1986f27df07","type":"JavaScriptFunction","parameters":{},"ports":[],"children":[]},{"id":"94f49f86-0928-a90c-505e-5953a33b0813","type":"JavaScriptFunction","parameters":{"functionScript":"const imageData = Inputs.imageData;\n\n// Convert base64 to blob\nconst byteString = atob(imageData.split(',')[1]);\nconst mimeString = imageData.split(',')[0].split(':')[1].split(';')[0];\nconst ab = new ArrayBuffer(byteString.length);\nconst ia = new Uint8Array(ab);\nfor (let i = 0; i < byteString.length; i++) {\n    ia[i] = byteString.charCodeAt(i);\n}\nconst blob = new Blob([ab], {type: mimeString});\n\n// Create a File object\nconst fileName = 'canvas_export.png';\nconst file = new File([blob], fileName, {type: 'image/png'});\n\nOutputs.ImageFile = file;\nOutputs.Success();"},"ports":[{"name":"in-imageData","displayName":"imageData","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-ImageFile","displayName":"ImageFile","plug":"output","type":"*","group":"Outputs","index":6}],"children":[]},{"id":"cd001303-473a-f82c-54dc-443f754aad45","type":"Upload File","parameters":{},"ports":[],"children":[]},{"id":"f758958c-ce5f-1e17-9afa-b4faa6b5e134","type":"/Show Toast","parameters":{"Message":"Something went wrong! Please try again.","Type":"Warning"},"ports":[],"children":[]},{"id":"fb872fb3-ea8c-0c6b-0777-cb645fc22022","type":"net.noodl.ComponentObject","parameters":{"properties":"tab"},"ports":[],"children":[]},{"id":"dc327013-87eb-1585-a373-60895218ed8a","type":"Expression","parameters":{"expression":"imageUrl != \"\""},"ports":[],"children":[]}],"connections":[{"sourceId":"68b43154-0fd0-e555-4250-eccb8f5e5de0","sourcePort":"didMount","targetId":"e268b984-e125-b4a6-c6bc-33d993b77383","targetPort":"fetch"},{"sourceId":"e268b984-e125-b4a6-c6bc-33d993b77383","sourcePort":"prop-emailVerified","targetId":"2126f86d-df30-2742-a678-abdbbbea502f","targetPort":"Verified"},{"sourceId":"faddb52c-1822-529c-bb28-82942a02434f","sourcePort":"sessionLost","targetId":"2562d44e-4100-8b6e-6b03-203dd9490c50","targetPort":"navigate"},{"sourceId":"41252a8d-affe-3aea-bac4-069a0729523c","sourcePort":"value","targetId":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","targetPort":"theme"},{"sourceId":"e268b984-e125-b4a6-c6bc-33d993b77383","sourcePort":"id","targetId":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","targetPort":"userId"},{"sourceId":"9dc23cf7-aa3d-b43b-8549-d850be358080","sourcePort":"onClick","targetId":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","targetPort":"Do"},{"sourceId":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","sourcePort":"response","targetId":"75de0e48-2cfc-16fd-4e90-e96be436e5b0","targetPort":"results"},{"sourceId":"75de0e48-2cfc-16fd-4e90-e96be436e5b0","sourcePort":"result","targetId":"7d757882-a9c6-0e72-aaf1-d32452cf4815","targetPort":"in-imageUrl"},{"sourceId":"e7b77823-ffee-11bc-29d3-9503dcaa22fe","sourcePort":"this","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"This"},{"sourceId":"3813ae8c-be44-a6d6-ed79-61c046e24603","sourcePort":"out-Loaded","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"Setup"},{"sourceId":"390d8824-75e0-aca4-200b-6fd23819be3f","sourcePort":"didMount","targetId":"3813ae8c-be44-a6d6-ed79-61c046e24603","targetPort":"run"},{"sourceId":"7d757882-a9c6-0e72-aaf1-d32452cf4815","sourcePort":"out-Success","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"AddImageFromUrl"},{"sourceId":"41252a8d-affe-3aea-bac4-069a0729523c","sourcePort":"value","targetId":"fa1a59d5-33bf-85c1-dc3f-5f58fb370b82","targetPort":"theme"},{"sourceId":"58059581-3964-407f-86d0-4dbbf7729b80","sourcePort":"onTextChanged","targetId":"fa1a59d5-33bf-85c1-dc3f-5f58fb370b82","targetPort":"name"},{"sourceId":"fa1a59d5-33bf-85c1-dc3f-5f58fb370b82","sourcePort":"result","targetId":"9dc23cf7-aa3d-b43b-8549-d850be358080","targetPort":"enabled"},{"sourceId":"58059581-3964-407f-86d0-4dbbf7729b80","sourcePort":"onTextChanged","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"Text"},{"sourceId":"7d757882-a9c6-0e72-aaf1-d32452cf4815","sourcePort":"out-Success","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"AddText"},{"sourceId":"7d757882-a9c6-0e72-aaf1-d32452cf4815","sourcePort":"out-pngUrl","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"ImageUrl"},{"sourceId":"9dc23cf7-aa3d-b43b-8549-d850be358080","sourcePort":"onClick","targetId":"e3e7c59c-7607-8f9f-77be-b06276e889b8","targetPort":"show"},{"sourceId":"7d757882-a9c6-0e72-aaf1-d32452cf4815","sourcePort":"out-Success","targetId":"dd15fa59-dbe6-9e70-3ee9-054bf45d9ef2","targetPort":"sendEvent"},{"sourceId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","sourcePort":"ImageExported","targetId":"e62a9624-4559-b212-8ba9-d1c6a0056c1c","targetPort":"upload"},{"sourceId":"e62a9624-4559-b212-8ba9-d1c6a0056c1c","sourcePort":"cloudFile","targetId":"1c01d3e5-d815-5cdc-de34-79d841bf6e67","targetPort":"prop-labelFile"},{"sourceId":"f006d435-0dde-564c-ec14-a00690f1fddc","sourcePort":"id","targetId":"1c01d3e5-d815-5cdc-de34-79d841bf6e67","targetPort":"prop-owner"},{"sourceId":"7d757882-a9c6-0e72-aaf1-d32452cf4815","sourcePort":"out-Success","targetId":"41e5e30f-416f-0ec7-10ff-3819f1f54a55","targetPort":"start"},{"sourceId":"9dc23cf7-aa3d-b43b-8549-d850be358080","sourcePort":"onClick","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"ResetCanvas"},{"sourceId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","sourcePort":"ImageFile","targetId":"e62a9624-4559-b212-8ba9-d1c6a0056c1c","targetPort":"file"},{"sourceId":"2d3b41e4-8411-3722-c00b-2fef8cbed848","sourcePort":"onClick","targetId":"c548e536-4117-8e5f-1b3c-ec57591a3373","targetPort":"to-community"},{"sourceId":"953c52fc-32c5-557a-6d45-b03766b2c0d6","sourcePort":"onClick","targetId":"c548e536-4117-8e5f-1b3c-ec57591a3373","targetPort":"to-mine"},{"sourceId":"c548e536-4117-8e5f-1b3c-ec57591a3373","sourcePort":"communityBottomBorder","targetId":"2d3b41e4-8411-3722-c00b-2fef8cbed848","targetPort":"borderBottomColor"},{"sourceId":"c548e536-4117-8e5f-1b3c-ec57591a3373","sourcePort":"myBottomBorder","targetId":"953c52fc-32c5-557a-6d45-b03766b2c0d6","targetPort":"borderBottomColor"},{"sourceId":"bc7bb39a-7cd1-6f70-6e62-c11005df965c","sourcePort":"items","targetId":"9e4510bf-a0e0-3982-f1f0-9c331bb148bf","targetPort":"in-myLabels"},{"sourceId":"9e4510bf-a0e0-3982-f1f0-9c331bb148bf","sourcePort":"out-array","targetId":"d4ad2569-b906-6790-31e0-023316f5ef5c","targetPort":"items"},{"sourceId":"c548e536-4117-8e5f-1b3c-ec57591a3373","sourcePort":"currentState","targetId":"9e4510bf-a0e0-3982-f1f0-9c331bb148bf","targetPort":"in-tab"},{"sourceId":"75de0e48-2cfc-16fd-4e90-e96be436e5b0","sourcePort":"result","targetId":"ed5eb6df-57fd-0d40-a624-77d27cd30a58","targetPort":"imageUrl"},{"sourceId":"ed5eb6df-57fd-0d40-a624-77d27cd30a58","sourcePort":"result","targetId":"0e7365ab-0e07-db59-c682-6a524a1f611d","targetPort":"mounted"},{"sourceId":"e696c016-3d2b-a3fd-2ce9-e5bb2ef7e32d","sourcePort":"onClick","targetId":"bb83407a-428d-76fa-8e22-0a292e9ffe98","targetPort":"mount"},{"sourceId":"728a7068-e1bb-0a33-cab8-3f1e2f35db90","sourcePort":"colour","targetId":"6ecdd8ce-5c93-3d32-eff4-7100347410fd","targetPort":"backgroundColor"},{"sourceId":"6ecdd8ce-5c93-3d32-eff4-7100347410fd","sourcePort":"onTextChanged","targetId":"728a7068-e1bb-0a33-cab8-3f1e2f35db90","targetPort":"currentState"},{"sourceId":"bb83407a-428d-76fa-8e22-0a292e9ffe98","sourcePort":"itemValue","targetId":"6ecdd8ce-5c93-3d32-eff4-7100347410fd","targetPort":"startValue"},{"sourceId":"6ecdd8ce-5c93-3d32-eff4-7100347410fd","sourcePort":"onTextChanged","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"BackgroundColor"},{"sourceId":"9b2e4cb5-3f48-f70b-6907-7f836376b0c8","sourcePort":"items","targetId":"e5fac525-9fcb-7401-8079-c8e48fbce6b9","targetPort":"items"},{"sourceId":"e5fac525-9fcb-7401-8079-c8e48fbce6b9","sourcePort":"items","targetId":"9e4510bf-a0e0-3982-f1f0-9c331bb148bf","targetPort":"in-allLabels"},{"sourceId":"6ecdd8ce-5c93-3d32-eff4-7100347410fd","sourcePort":"onTextChanged","targetId":"1c01d3e5-d815-5cdc-de34-79d841bf6e67","targetPort":"prop-backgroundColour"},{"sourceId":"58059581-3964-407f-86d0-4dbbf7729b80","sourcePort":"onTextChanged","targetId":"1c01d3e5-d815-5cdc-de34-79d841bf6e67","targetPort":"prop-name"},{"sourceId":"cd001303-473a-f82c-54dc-443f754aad45","sourcePort":"cloudFile","targetId":"1c01d3e5-d815-5cdc-de34-79d841bf6e67","targetPort":"prop-aiImage"},{"sourceId":"cd001303-473a-f82c-54dc-443f754aad45","sourcePort":"success","targetId":"1c01d3e5-d815-5cdc-de34-79d841bf6e67","targetPort":"store"},{"sourceId":"e62a9624-4559-b212-8ba9-d1c6a0056c1c","sourcePort":"success","targetId":"94f49f86-0928-a90c-505e-5953a33b0813","targetPort":"run"},{"sourceId":"94f49f86-0928-a90c-505e-5953a33b0813","sourcePort":"out-Success","targetId":"cd001303-473a-f82c-54dc-443f754aad45","targetPort":"upload"},{"sourceId":"94f49f86-0928-a90c-505e-5953a33b0813","sourcePort":"out-ImageFile","targetId":"cd001303-473a-f82c-54dc-443f754aad45","targetPort":"file"},{"sourceId":"7d757882-a9c6-0e72-aaf1-d32452cf4815","sourcePort":"out-pngUrl","targetId":"94f49f86-0928-a90c-505e-5953a33b0813","targetPort":"in-imageData"},{"sourceId":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","sourcePort":"Failed","targetId":"dd15fa59-dbe6-9e70-3ee9-054bf45d9ef2","targetPort":"sendEvent"},{"sourceId":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","sourcePort":"Failed","targetId":"f758958c-ce5f-1e17-9afa-b4faa6b5e134","targetPort":"Do"},{"sourceId":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","sourcePort":"error","targetId":"f758958c-ce5f-1e17-9afa-b4faa6b5e134","targetPort":"Message"},{"sourceId":"c548e536-4117-8e5f-1b3c-ec57591a3373","sourcePort":"currentState","targetId":"fb872fb3-ea8c-0c6b-0777-cb645fc22022","targetPort":"value-tab"},{"sourceId":"dc327013-87eb-1585-a373-60895218ed8a","sourcePort":"result","targetId":"2c405be8-0bb4-6a0b-ea83-eda0eba24f68","targetPort":"mounted"},{"sourceId":"7d757882-a9c6-0e72-aaf1-d32452cf4815","sourcePort":"out-pngUrl","targetId":"dc327013-87eb-1585-a373-60895218ed8a","targetPort":"imageUrl"},{"sourceId":"6096bec8-b19c-fb14-238a-e061fe8e59d3","sourcePort":"onClick","targetId":"319d7186-a007-008c-4abc-21ffdeb2e4e6","targetPort":"ExportAsImage"},{"sourceId":"a713fcc7-01f3-6c13-c52a-1b6e1e318986","sourcePort":"onClick","targetId":"ac9182b0-7bb5-2b39-0fb7-ea1d78687815","targetPort":"Do"}],"ports":[],"roots":["68b43154-0fd0-e555-4250-eccb8f5e5de0"],"metadata":{"isFolderComponent":false}},{"name":"/Main/label item","nodes":[{"id":"96c967d4-4cd3-98e3-b157-50b45003dd21","type":"Group","parameters":{"scrollEnabled":false,"sizeMode":"explicit","minWidth":{"value":600,"unit":"px"}},"ports":[],"children":[{"id":"31190486-e2c2-4da9-dbd3-45097d625ca0","type":"Image","parameters":{"sizeMode":"explicit","width":{"value":600,"unit":"px"},"height":{"value":160,"unit":"px"},"objectFit":"contain"},"ports":[],"children":[]},{"id":"ba0485f2-67ae-781a-caaf-f95a680e8095","type":"net.noodl.controls.button","parameters":{"position":"absolute","alignX":"left","label":"Share","alignY":"bottom","marginBottom":{"value":-5,"unit":"px"},"marginLeft":{"value":-5,"unit":"px"}},"ports":[],"children":[]},{"id":"7351e143-4807-3de5-32a0-c9f2afe0e40d","type":"net.noodl.controls.button","parameters":{"position":"absolute","alignX":"left","label":"Make it my own","alignY":"bottom","marginLeft":{"value":460,"unit":"px"},"marginBottom":{"value":-5,"unit":"px"}},"ports":[],"children":[]},{"id":"a31a5842-3619-c2a6-0ae7-b33b3cd4e6fd","type":"net.noodl.controls.button","parameters":{"position":"absolute","alignX":"left","label":"Change name","alignY":"bottom","marginLeft":{"value":465,"unit":"px"},"sizeMode":"contentWidth","minWidth":{"value":140,"unit":"px"},"marginBottom":{"value":-5,"unit":"px"}},"ports":[],"children":[]}]},{"id":"69e0d315-f63b-2b0e-ea7a-cf4ac9ae0a44","type":"DbModel2","parameters":{"collectionName":"Label","idSource":"foreach"},"ports":[],"children":[]},{"id":"5b074c6d-ef75-cf68-c167-aeedaa5dbbc0","type":"Cloud File","parameters":{},"ports":[],"children":[]},{"id":"6d841f23-4edf-73fc-3dc3-4ec5128369e3","type":"NewDbModelProperties","parameters":{"collectionName":"Label","prop-community":false},"ports":[],"children":[]},{"id":"b30b8d2c-8446-742d-2698-ce6a7acd3de0","type":"net.noodl.user.User","parameters":{},"ports":[],"children":[]},{"id":"9e756488-621a-5419-1611-c67f19492a4a","type":"/Show Toast","parameters":{"Message":"Copied to 'My labels'","Type":"Success"},"ports":[],"children":[]},{"id":"4f8e45a9-b25a-868e-e573-69345e341c90","type":"Boolean","parameters":{"value":false},"ports":[],"children":[]},{"id":"3c0ccf9e-d055-4b9b-0738-3d117e5b3fe1","type":"net.noodl.ParentComponentObject","parameters":{"properties":"tab"},"ports":[],"children":[]},{"id":"9f74d1fa-1276-d1e0-6140-f5ad90c358bf","type":"Expression","parameters":{"expression":"tab !== \"mine\""},"ports":[],"children":[]},{"id":"a0a2955f-5f82-1b19-5a67-b9e9f879cc30","type":"NavigationShowPopup","parameters":{"target":"/#Global visual components/Popup template"},"ports":[],"children":[]},{"id":"a1a203a1-53a4-9798-9c46-2191ef15393d","type":"NavigationShowPopup","parameters":{"target":"/#Global visual components/Popup share"},"ports":[],"children":[]}],"connections":[{"sourceId":"69e0d315-f63b-2b0e-ea7a-cf4ac9ae0a44","sourcePort":"prop-labelFile","targetId":"5b074c6d-ef75-cf68-c167-aeedaa5dbbc0","targetPort":"file"},{"sourceId":"5b074c6d-ef75-cf68-c167-aeedaa5dbbc0","sourcePort":"url","targetId":"31190486-e2c2-4da9-dbd3-45097d625ca0","targetPort":"src"},{"sourceId":"69e0d315-f63b-2b0e-ea7a-cf4ac9ae0a44","sourcePort":"id","targetId":"6d841f23-4edf-73fc-3dc3-4ec5128369e3","targetPort":"sourceObjectId"},{"sourceId":"b30b8d2c-8446-742d-2698-ce6a7acd3de0","sourcePort":"id","targetId":"6d841f23-4edf-73fc-3dc3-4ec5128369e3","targetPort":"prop-owner"},{"sourceId":"7351e143-4807-3de5-32a0-c9f2afe0e40d","sourcePort":"onClick","targetId":"6d841f23-4edf-73fc-3dc3-4ec5128369e3","targetPort":"store"},{"sourceId":"6d841f23-4edf-73fc-3dc3-4ec5128369e3","sourcePort":"created","targetId":"9e756488-621a-5419-1611-c67f19492a4a","targetPort":"Do"},{"sourceId":"4f8e45a9-b25a-868e-e573-69345e341c90","sourcePort":"savedValue","targetId":"6d841f23-4edf-73fc-3dc3-4ec5128369e3","targetPort":"prop-community"},{"sourceId":"3c0ccf9e-d055-4b9b-0738-3d117e5b3fe1","sourcePort":"value-tab","targetId":"9f74d1fa-1276-d1e0-6140-f5ad90c358bf","targetPort":"tab"},{"sourceId":"9f74d1fa-1276-d1e0-6140-f5ad90c358bf","sourcePort":"result","targetId":"7351e143-4807-3de5-32a0-c9f2afe0e40d","targetPort":"mounted"},{"sourceId":"a31a5842-3619-c2a6-0ae7-b33b3cd4e6fd","sourcePort":"onClick","targetId":"a0a2955f-5f82-1b19-5a67-b9e9f879cc30","targetPort":"show"},{"sourceId":"9f74d1fa-1276-d1e0-6140-f5ad90c358bf","sourcePort":"isFalse","targetId":"a31a5842-3619-c2a6-0ae7-b33b3cd4e6fd","targetPort":"mounted"},{"sourceId":"69e0d315-f63b-2b0e-ea7a-cf4ac9ae0a44","sourcePort":"id","targetId":"a0a2955f-5f82-1b19-5a67-b9e9f879cc30","targetPort":"popupParam-label"},{"sourceId":"ba0485f2-67ae-781a-caaf-f95a680e8095","sourcePort":"onClick","targetId":"a1a203a1-53a4-9798-9c46-2191ef15393d","targetPort":"show"},{"sourceId":"69e0d315-f63b-2b0e-ea7a-cf4ac9ae0a44","sourcePort":"id","targetId":"a1a203a1-53a4-9798-9c46-2191ef15393d","targetPort":"popupParam-label"}],"ports":[],"roots":["96c967d4-4cd3-98e3-b157-50b45003dd21"]},{"name":"/#Global visual components/Popup template","nodes":[{"id":"9b058164-3898-218e-bcdb-989d4e8caaaa","type":"Group","parameters":{"position":"fixed","backgroundColor":"#00000099","zIndex":4},"ports":[],"children":[{"id":"dbb64b53-72a5-5cf3-e1e1-8fc46d534535","type":"Group","parameters":{"position":"fixed","marginTop":{"value":-200,"unit":"px"}},"ports":[],"children":[]},{"id":"e9171b32-6af7-d643-448d-4261bfbacadf","type":"Group","parameters":{"position":"absolute","alignY":"center","alignX":"center","sizeMode":"contentHeight","width":{"value":300,"unit":"px"},"paddingLeft":{"value":40,"unit":"px"},"paddingRight":{"value":40,"unit":"px"},"paddingTop":{"value":40,"unit":"px"},"paddingBottom":{"value":40,"unit":"px"},"rowGap":{"value":20,"unit":"px"},"backgroundColor":"White","borderRadius":{"value":8,"unit":"px"}},"ports":[],"children":[{"id":"ffe9e84a-2147-b045-4f4f-2f340dfb94a3","type":"/#Global visual components/Clickable icon","parameters":{"position":"absolute","align X":"right","icon":{"class":"material-icons","code":"close","codeAsClass":false},"margin top":{"value":10,"unit":"px"},"margin right":{"value":10,"unit":"px"}},"ports":[],"children":[]},{"id":"8b47c1d5-987e-91df-05ba-b1e02b1c9fd0","type":"Text","parameters":{"text":"Change label name","textStyle":"Title Large"},"ports":[],"children":[]},{"id":"c50910aa-4854-4cd2-9905-1b6ae280f69c","type":"net.noodl.controls.textinput","variant":"Text Input","parameters":{"label":"New name","labeltextStyle":"Label Medium"},"ports":[],"children":[]},{"id":"82a2e13d-79bd-b1af-3ed4-802c79e5e794","type":"Group","parameters":{"maxWidth":{"value":200,"unit":"px"},"minWidth":{"value":150,"unit":"px"},"sizeMode":"explicit","height":{"value":60,"unit":"px"}},"ports":[],"children":[{"id":"c8d169b1-344c-9869-f07a-de7bc287b913","type":"net.noodl.controls.textinput","parameters":{"label":"Select a label colour","placeholder":"#FFE6D5","startValue":"#FFE6D5","enabled":false,"position":"absolute"},"stateParameters":{"disabled":{"backgroundColor":"White","borderColor":"Grey - 900","textStyle":"Label Large","color":"Grey - 900","labeltextStyle":"Label Medium","labelcolor":"Grey - 900"}},"ports":[],"children":[]},{"id":"4f0d7a4c-8123-23ab-59c7-6bbe19ccf69f","type":"Group","parameters":{"position":"absolute","zIndex":2},"ports":[],"children":[]},{"id":"7f40b2dc-86b8-7fc3-4325-91136e58d09e","type":"/#Global visual components/Context menu","parameters":{"items":"[\n    {\n        \"label\": \"Beige\",\n        \"value\": \"#FFE6D5\"\n    },\n    {\n        \"label\": \"Blue\",\n        \"value\": \"#B3E5FC\"\n    },\n    {\n        \"label\": \"Green\",\n        \"value\": \"#B2F2BB\"\n    },\n    {\n        \"label\": \"Pink\",\n        \"value\": \"#FFB6C1\"\n    },\n    {\n        \"label\": \"Purple\",\n        \"value\": \"#E6E6FA\"\n    },\n    {\n        \"label\": \"Yellow\",\n        \"value\": \"#FFFACD\"\n    }\n]","offsetTop":{"value":60,"unit":"px"},"offsetLeft":{"value":0,"unit":"px"},"alignX":"left"},"ports":[],"children":[]}]},{"id":"d6fc04bb-b996-de71-1bbf-d817f290b4b4","type":"Group","parameters":{},"ports":[],"children":[{"id":"1e536898-4119-604a-2861-a11dbbf2332e","type":"net.noodl.controls.button","variant":"Primary button","parameters":{"label":"Accept","maxWidth":{"value":999,"unit":"px"}},"ports":[],"children":[]}]}]}]},{"id":"974567a5-ee86-cd44-1063-7e24e88a9d5a","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","type":"SetDbModelProperties","parameters":{"collectionName":"Label"},"ports":[],"children":[]},{"id":"3bc72c8f-516b-26e6-7875-9455a9330ae4","type":"DbModel2","parameters":{"collectionName":"Label"},"ports":[],"children":[]},{"id":"ed73b915-dab8-84b7-6133-d2817bd72993","type":"NavigationClosePopup","parameters":{"closeActions":"Done"},"ports":[],"children":[]},{"id":"13bfd442-ed4d-c3cf-a5c6-54bdc9224124","type":"States","parameters":{"states":"#FFE6D5,#B3E5FC,#B2F2BB,#FFB6C1,#E6E6FA,#FFFACD","values":"colour","type-colour":"color","useTransitions":true,"value-#FFE6D5-colour":"#FFE6D5","value-#B2F2BB-colour":"#B2F2BB","value-#FFB6C1-colour":"#FFB6C1","value-#E6E6FA-colour":"#E6E6FA","value-#FFFACD-colour":"#FFFACD","value-#B3E5FC-colour":"#B3E5FC"},"ports":[],"children":[]},{"id":"37583cf3-6f42-31cb-d66e-e1abcb99170f","type":"JavaScriptFunction","parameters":{"functionScript":"const fabricUniqueId = '--fabric-js--';\nconst fabricScriptUrl = `https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js`;\n\nfunction injectFabricScript(onload) {\n    if (!document.querySelector(`#${fabricUniqueId}`)) {\n        const script = document.createElement('script');\n        script.id = fabricUniqueId;\n        script.src = fabricScriptUrl;\n        script.onload = () => {\n            console.log('Fabric.js loaded successfully');\n            onload();\n        };\n        script.onerror = () => {\n            console.error('Failed to load Fabric.js');\n        };\n        document.head.appendChild(script);\n    } else {\n        console.log('Fabric.js already loaded');\n        onload();\n    }\n}\n\ninjectFabricScript(() => {\n    Outputs.Loaded();\n});\n"},"ports":[{"name":"out-Loaded","displayName":"Loaded","plug":"output","type":"signal","group":"Outputs","index":4}],"children":[]},{"id":"317e4444-20e9-43b2-bf1e-80d50b1b4815","type":"Javascript2","parameters":{"code":"let canvas = null;\n\n// Font loading function\nfunction loadFont(fontName, fontUrl) {\n    const font = new FontFace(fontName, `url(${fontUrl})`);\n    font.load().then((loadedFont) => {\n        document.fonts.add(loadedFont);\n        console.log(`Font ${fontName} loaded successfully`);\n        // Refresh the canvas to apply the new font\n        if (canvas) {\n            canvas.renderAll();\n        }\n    }).catch((error) => {\n        console.error(`Error loading font ${fontName}:`, error);\n    });\n}\n\nScript.Signals.Setup = function () {\n    const element = Script.Inputs.This.getDOMElement();\n    console.log('Element received:', element);\n\n    if (!element) {\n        console.error('No element received from This input');\n        return;\n    }\n\n    if (!element.querySelector('canvas')) {\n        const canvasElement = document.createElement('canvas');\n        canvasElement.id = 'fabricCanvas';\n        canvasElement.width = Script.Inputs.CanvasWidth || 600;\n        canvasElement.height = Script.Inputs.CanvasHeight || 160;\n        element.appendChild(canvasElement);\n        console.log('Canvas element created and appended');\n    }\n\n    const canvasElement = element.querySelector('canvas');\n    console.log('Canvas element:', canvasElement);\n\n    if (!canvasElement) {\n        console.error('Canvas element could not be found');\n        return;\n    }\n\n    try {\n        canvas = new fabric.Canvas(canvasElement);\n        console.log('Fabric.js canvas initialized:', canvas);\n\n        // Add rounded corners\n        const radius = Script.Inputs.CornerRadius || 20; // default corner radius of 20px\n        const rect = new fabric.Rect({\n            width: canvas.width,\n            height: canvas.height,\n            rx: radius,\n            ry: radius,\n            fill: 'transparent'\n        });\n        canvas.clipPath = rect;\n\n        // Check if a background color is provided, and only set the default if none is provided\n        const defaultBackgroundColor = \"#FFE6D5\";  // Soft peach\n        const bgColor = Script.Inputs.BackgroundColor || defaultBackgroundColor;\n        canvas.setBackgroundColor(bgColor, canvas.renderAll.bind(canvas));\n        canvas.initialBackgroundColor = bgColor;\n\n    } catch (error) {\n        console.error('Failed to initialize Fabric.js canvas:', error);\n    }\n\n    // Load the Fredoka font\n    loadFont('Fredoka', '/fonts/Fredoka/static/Fredoka-Regular.ttf');\n\n    Script.Outputs.CanvasReady();\n};\n\n// Updated signal to add text with specific positioning and alignment\nScript.Signals.AddText = function () {\n    if (canvas) {\n        const textAreaWidth = 400; // 600px - 200px\n        const text = new fabric.Textbox(Script.Inputs.Text || 'Editable Text', {\n            left: 140,\n            top: 50, // You can adjust this value as needed\n            width: textAreaWidth,\n            fontFamily: Script.Inputs.FontFamily || 'Fredoka, sans-serif', // Set Fredoka as default\n            fontSize: Script.Inputs.FontSize || 80,\n            fill: Script.Inputs.TextColor || 'black',\n            textAlign: 'center',\n            originX: 'left',\n            originY: 'top',\n            // Adding options to make canvas additions static. This should be revised later in future versions\n            selectable: false,   // Make the text static\n            hasControls: false,  // Disable controls for resizing or rotating\n            evented: false       // Disable interaction events\n        });\n\n        // Center the text vertically within the canvas\n        text.top = (canvas.height - text.height) / 2;\n\n        canvas.add(text);\n        canvas.renderAll();\n        console.log('Text added to canvas:', text);\n    }\n};\n\n// Updated signal to add an image from a URL with resizing\nScript.Signals.AddImageFromUrl = function () {\n    const imageUrl = Script.Inputs.ImageUrl;\n    console.log('Adding image from URL:', imageUrl);\n\n    if (canvas && imageUrl) {\n        fabric.Image.fromURL(imageUrl, function (img) {\n            // Calculate scaling factor to fit height to 200px max\n            const scaleFactor = 160 / img.height;\n            \n            // Only scale down, not up\n            if (scaleFactor < 1) {\n                img.scale(scaleFactor);\n            }\n\n            canvas.add(img);\n            canvas.renderAll();\n            console.log('Image added to canvas:', img);\n        }, { \n            crossOrigin: 'anonymous',\n        });\n    }\n};\n\n// Updated signal to export the canvas as an image file\nScript.Signals.ExportAsImage = function () {\n    if (canvas) {\n        const imageData = canvas.toDataURL({\n            format: 'png',\n            quality: 1\n        });\n\n        // Convert base64 to blob\n        const byteString = atob(imageData.split(',')[1]);\n        const mimeString = imageData.split(',')[0].split(':')[1].split(';')[0];\n        const ab = new ArrayBuffer(byteString.length);\n        const ia = new Uint8Array(ab);\n        for (let i = 0; i < byteString.length; i++) {\n            ia[i] = byteString.charCodeAt(i);\n        }\n        const blob = new Blob([ab], {type: mimeString});\n\n        // Create a File object\n        const fileName = 'canvas_export.png';\n        const file = new File([blob], fileName, {type: 'image/png'});\n\n        Script.Outputs.ImageFile = file;\n        Script.Outputs.ImageExported();\n        console.log('Canvas exported as image file:', fileName);\n    }\n};\n\n// New signal to reset the canvas\nScript.Signals.ResetCanvas = function () {\n    if (canvas) {\n        // Clear all objects from the canvas\n        canvas.clear();\n        \n        // Reapply the background color if it was set\n        if (Script.Inputs.BackgroundColor) {\n            canvas.setBackgroundColor(Script.Inputs.BackgroundColor, canvas.renderAll.bind(canvas));\n        }\n        \n        canvas.renderAll();\n        console.log('Canvas reset: All objects removed');\n    } else {\n        console.log('Canvas not initialized, unable to reset');\n    }\n};\n\n// Cleanup when the node is unmounted\nScript.OnDestroy = function () {\n    if (canvas) {\n        canvas.dispose();\n        canvas = null;\n        console.log('Canvas disposed');\n    }\n};\n\nScript.Signals.DeleteSelectedObject = function () {\n    if (canvas) {\n        const activeObject = canvas.getActiveObject();\n        if (activeObject) {\n            canvas.remove(activeObject);\n            canvas.renderAll();\n            console.log('Selected object deleted:', activeObject);\n        } else {\n            console.log('No object selected to delete');\n        }\n    }\n};\n\n// New signal to set the background color\nScript.Signals.SetBackgroundColor = function () {\n    if (canvas) {\n        const color = Script.Inputs.colour;\n        if (color) {\n            canvas.setBackgroundColor(color, function () {\n                canvas.renderAll();  // Ensure the canvas re-renders after setting the background color\n                console.log('Canvas background color set to:', color);\n            });\n        } else {\n            console.log('No color specified for background');\n        }\n    }\n};\n"},"ports":[{"name":"Setup","plug":"input","type":{"name":"signal"},"group":"Inputs","index":5},{"name":"AddText","plug":"input","type":{"name":"signal"},"group":"Inputs","index":6},{"name":"AddImageFromUrl","plug":"input","type":{"name":"signal"},"group":"Inputs","index":7},{"name":"ExportAsImage","plug":"input","type":{"name":"signal"},"group":"Inputs","index":8},{"name":"ResetCanvas","plug":"input","type":{"name":"signal"},"group":"Inputs","index":9},{"name":"DeleteSelectedObject","plug":"input","type":{"name":"signal"},"group":"Inputs","index":10},{"name":"SetBackgroundColor","plug":"input","type":{"name":"signal"},"group":"Inputs","index":11},{"name":"This","displayName":"This","plug":"input","type":"*","group":"Inputs","index":12},{"name":"CanvasWidth","displayName":"CanvasWidth","plug":"input","type":"*","group":"Inputs","index":13},{"name":"CanvasHeight","displayName":"CanvasHeight","plug":"input","type":"*","group":"Inputs","index":14},{"name":"CornerRadius","displayName":"CornerRadius","plug":"input","type":"*","group":"Inputs","index":15},{"name":"BackgroundColor","displayName":"BackgroundColor","plug":"input","type":"*","group":"Inputs","index":16},{"name":"Text","displayName":"Text","plug":"input","type":"*","group":"Inputs","index":17},{"name":"FontFamily","displayName":"FontFamily","plug":"input","type":"*","group":"Inputs","index":18},{"name":"FontSize","displayName":"FontSize","plug":"input","type":"*","group":"Inputs","index":19},{"name":"TextColor","displayName":"TextColor","plug":"input","type":"*","group":"Inputs","index":20},{"name":"ImageUrl","displayName":"ImageUrl","plug":"input","type":"*","group":"Inputs","index":21},{"name":"colour","displayName":"colour","plug":"input","type":"*","group":"Inputs","index":22},{"name":"CanvasReady","displayName":"CanvasReady","plug":"output","type":"signal","group":"Outputs","index":23},{"name":"ImageExported","displayName":"ImageExported","plug":"output","type":"signal","group":"Outputs","index":24},{"name":"ImageFile","displayName":"ImageFile","plug":"output","type":"*","group":"Outputs","index":25}],"children":[]},{"id":"47f69e36-8863-50b6-5318-4cd424a5f562","type":"JavaScriptFunction","parameters":{"functionScript":"const imageUrl = Inputs.ImageUrl || '';\nif (!imageUrl) throw new Error('Invalid image url');\n\ntry {\n  // Fetch the image from the provided url\n  const response = await fetch(imageUrl);\n  // Convert the fetched image to Blob\n  const blob = await response.blob();\n  // Create a FileReader object\n  const reader = new FileReader();\n  // Read the blob as a base64 string\n  reader.readAsDataURL(blob);\n  // Wait for the reader to finish\n  reader.onloadend = function() {\n    // Extract the base64 string from the result\n    const base64data = reader.result;\n    // Output the base64 string\n    Outputs.Base64String = base64data;\n    Outputs.Success();\n  }\n} catch (error) {\n  Outputs.error = error;\n  Outputs.Failure();\n}\n"},"ports":[{"name":"in-ImageUrl","displayName":"ImageUrl","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-Base64String","displayName":"Base64String","plug":"output","type":"*","group":"Outputs","index":7},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":8}],"children":[]},{"id":"ec1c4576-f82b-6698-b942-94c0a65fa869","type":"Cloud File","parameters":{},"ports":[],"children":[]},{"id":"fb9c264e-554c-8efe-8898-1b587150a4cb","type":"Upload File","parameters":{},"ports":[],"children":[]},{"id":"0392df18-6cf2-0312-2f68-8e3bdc3816b9","type":"Timer","parameters":{"duration":500},"ports":[],"children":[]}],"connections":[{"sourceId":"974567a5-ee86-cd44-1063-7e24e88a9d5a","sourcePort":"label","targetId":"3bc72c8f-516b-26e6-7875-9455a9330ae4","targetPort":"modelId"},{"sourceId":"c50910aa-4854-4cd2-9905-1b6ae280f69c","sourcePort":"onTextChanged","targetId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","targetPort":"prop-name"},{"sourceId":"974567a5-ee86-cd44-1063-7e24e88a9d5a","sourcePort":"label","targetId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","targetPort":"modelId"},{"sourceId":"ffe9e84a-2147-b045-4f4f-2f340dfb94a3","sourcePort":"clicked","targetId":"ed73b915-dab8-84b7-6133-d2817bd72993","targetPort":"close"},{"sourceId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","sourcePort":"stored","targetId":"ed73b915-dab8-84b7-6133-d2817bd72993","targetPort":"close"},{"sourceId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","sourcePort":"stored","targetId":"ed73b915-dab8-84b7-6133-d2817bd72993","targetPort":"closeAction-Done"},{"sourceId":"4f0d7a4c-8123-23ab-59c7-6bbe19ccf69f","sourcePort":"onClick","targetId":"7f40b2dc-86b8-7fc3-4325-91136e58d09e","targetPort":"mount"},{"sourceId":"7f40b2dc-86b8-7fc3-4325-91136e58d09e","sourcePort":"itemValue","targetId":"c8d169b1-344c-9869-f07a-de7bc287b913","targetPort":"startValue"},{"sourceId":"c8d169b1-344c-9869-f07a-de7bc287b913","sourcePort":"onTextChanged","targetId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","targetPort":"prop-backgroundColour"},{"sourceId":"c8d169b1-344c-9869-f07a-de7bc287b913","sourcePort":"onTextChanged","targetId":"13bfd442-ed4d-c3cf-a5c6-54bdc9224124","targetPort":"currentState"},{"sourceId":"13bfd442-ed4d-c3cf-a5c6-54bdc9224124","sourcePort":"colour","targetId":"c8d169b1-344c-9869-f07a-de7bc287b913","targetPort":"backgroundColor"},{"sourceId":"3bc72c8f-516b-26e6-7875-9455a9330ae4","sourcePort":"prop-backgroundColour","targetId":"c8d169b1-344c-9869-f07a-de7bc287b913","targetPort":"startValue"},{"sourceId":"3bc72c8f-516b-26e6-7875-9455a9330ae4","sourcePort":"prop-name","targetId":"c50910aa-4854-4cd2-9905-1b6ae280f69c","targetPort":"startValue"},{"sourceId":"3bc72c8f-516b-26e6-7875-9455a9330ae4","sourcePort":"prop-aiImage","targetId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","targetPort":"prop-aiImage"},{"sourceId":"37583cf3-6f42-31cb-d66e-e1abcb99170f","sourcePort":"out-Loaded","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"Setup"},{"sourceId":"c50910aa-4854-4cd2-9905-1b6ae280f69c","sourcePort":"onTextChanged","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"Text"},{"sourceId":"c8d169b1-344c-9869-f07a-de7bc287b913","sourcePort":"onTextChanged","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"BackgroundColor"},{"sourceId":"3bc72c8f-516b-26e6-7875-9455a9330ae4","sourcePort":"prop-aiImage","targetId":"ec1c4576-f82b-6698-b942-94c0a65fa869","targetPort":"file"},{"sourceId":"ec1c4576-f82b-6698-b942-94c0a65fa869","sourcePort":"url","targetId":"47f69e36-8863-50b6-5318-4cd424a5f562","targetPort":"in-ImageUrl"},{"sourceId":"47f69e36-8863-50b6-5318-4cd424a5f562","sourcePort":"out-Base64String","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"ImageUrl"},{"sourceId":"e9171b32-6af7-d643-448d-4261bfbacadf","sourcePort":"didMount","targetId":"37583cf3-6f42-31cb-d66e-e1abcb99170f","targetPort":"run"},{"sourceId":"dbb64b53-72a5-5cf3-e1e1-8fc46d534535","sourcePort":"this","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"This"},{"sourceId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","sourcePort":"ImageFile","targetId":"fb9c264e-554c-8efe-8898-1b587150a4cb","targetPort":"file"},{"sourceId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","sourcePort":"ImageExported","targetId":"fb9c264e-554c-8efe-8898-1b587150a4cb","targetPort":"upload"},{"sourceId":"fb9c264e-554c-8efe-8898-1b587150a4cb","sourcePort":"success","targetId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","targetPort":"store"},{"sourceId":"1e536898-4119-604a-2861-a11dbbf2332e","sourcePort":"onClick","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"AddText"},{"sourceId":"1e536898-4119-604a-2861-a11dbbf2332e","sourcePort":"onClick","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"AddImageFromUrl"},{"sourceId":"fb9c264e-554c-8efe-8898-1b587150a4cb","sourcePort":"success","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"ResetCanvas"},{"sourceId":"1e536898-4119-604a-2861-a11dbbf2332e","sourcePort":"onClick","targetId":"0392df18-6cf2-0312-2f68-8e3bdc3816b9","targetPort":"start"},{"sourceId":"0392df18-6cf2-0312-2f68-8e3bdc3816b9","sourcePort":"timerFinished","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"ExportAsImage"},{"sourceId":"fb9c264e-554c-8efe-8898-1b587150a4cb","sourcePort":"cloudFile","targetId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","targetPort":"prop-labelFile"},{"sourceId":"c8d169b1-344c-9869-f07a-de7bc287b913","sourcePort":"textChanged","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"SetBackgroundColor"},{"sourceId":"c8d169b1-344c-9869-f07a-de7bc287b913","sourcePort":"textChanged","targetId":"317e4444-20e9-43b2-bf1e-80d50b1b4815","targetPort":"ResetCanvas"},{"sourceId":"3bc72c8f-516b-26e6-7875-9455a9330ae4","sourcePort":"prop-community","targetId":"43d6f9cc-7c8a-1379-fdc1-dfc986465ec1","targetPort":"prop-community"}],"ports":[{"name":"label","type":{"name":"string","allowConnectionsOnly":true},"group":"General","plug":"input","index":1}],"roots":["9b058164-3898-218e-bcdb-989d4e8caaaa"]},{"name":"/#Global visual components/Popup share","nodes":[{"id":"b242b89b-ca98-2c92-ac33-a5d901097908","type":"Group","parameters":{"position":"fixed","backgroundColor":"#00000099","zIndex":4},"ports":[],"children":[{"id":"a76c3d6e-c71a-1b4c-41ae-f550f869fea8","type":"Group","parameters":{"position":"fixed","marginTop":{"value":-200,"unit":"px"}},"ports":[],"children":[]},{"id":"dacce3e0-dcdb-fd0c-a4c1-261f335acb61","type":"Group","parameters":{"position":"absolute","alignY":"center","alignX":"center","sizeMode":"contentHeight","width":{"value":300,"unit":"px"},"paddingLeft":{"value":40,"unit":"px"},"paddingRight":{"value":40,"unit":"px"},"paddingTop":{"value":40,"unit":"px"},"paddingBottom":{"value":40,"unit":"px"},"rowGap":{"value":20,"unit":"px"},"backgroundColor":"White","borderRadius":{"value":8,"unit":"px"}},"ports":[],"children":[{"id":"88754148-b72c-f598-279c-27c35b684a0c","type":"/#Global visual components/Clickable icon","parameters":{"position":"absolute","align X":"right","icon":{"class":"material-icons","code":"close","codeAsClass":false},"margin top":{"value":10,"unit":"px"},"margin right":{"value":10,"unit":"px"}},"ports":[],"children":[]},{"id":"bebcc81e-24d1-ba78-cb41-59cead6f71a2","type":"Text","parameters":{"text":"Share label","textStyle":"Title Large"},"ports":[],"children":[]},{"id":"2e40e29c-ac36-0409-dc30-5e380ad6e876","type":"Image","parameters":{"sizeMode":"explicit","alignX":"center","width":{"value":150,"unit":"px"},"height":{"value":150,"unit":"px"}},"ports":[],"children":[]},{"id":"9d24a707-1b7d-5255-d3b1-bb692b4d5cd6","type":"module.inlineHtml","parameters":{"html":"<!-- AddToAny BEGIN -->\n<div>\n<a href=\"https://www.addtoany.com/share#url={{urlEncoded}}&amp;title={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/a2a.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/email?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/email.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/facebook?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/facebook.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/facebook_messenger?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/facebook_messenger.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/whatsapp?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/whatsapp.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/telegram?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/telegram.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/pinterest?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/pinterest.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/reddit?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/reddit.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/x?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/x.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n<a href=\"https://www.addtoany.com/add_to/copy_link?linkurl={{urlEncoded}}&amp;linkname={{titleEncoded}}\" target=\"_blank\"><img src=\"https://static.addtoany.com/buttons/link.svg\" width=\"32\" height=\"32\" style=\"background-color:#6DD3CE\"></a>\n</div>\n<!-- AddToAny END -->","runJs":true},"ports":[],"children":[]}]}]},{"id":"e08b72b9-90e3-f1b3-7828-1c5c9367250e","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"229ea913-e8bf-2221-ab77-759a6b9abacb","type":"DbModel2","parameters":{"collectionName":"Label"},"ports":[],"children":[]},{"id":"6ac1f2be-1ecf-a9da-bd51-04b7b4970919","type":"NavigationClosePopup","parameters":{"closeActions":"Done"},"ports":[],"children":[]},{"id":"3d72c193-90d2-40c8-d810-c3d080eecb04","type":"Cloud File","parameters":{},"ports":[],"children":[]},{"id":"350849be-ac52-f1e0-64b4-e80063ceda7c","type":"JavaScriptFunction","parameters":{"functionScript":"const url = Inputs.URL || '';\nif (!url) throw new Error('Invalid URL');\n\nconst qrCodeSize = Inputs.QRCodeSize || '150x150';\nconst qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${qrCodeSize}&data=${url}`;\n\ntry {\n  const response = await fetch(qrCodeUrl);\n  if (!response.ok) throw new Error('Failed to generate QR code');\n  \n  // The API returns the QR code as an image, so we get the blob and convert it to a URL\n  const blob = await response.blob();\n  const qrCodeImage = URL.createObjectURL(blob);\n  \n  Outputs.QRCodeImage = qrCodeImage;\n  Outputs.Success();\n} catch (error) {\n  Outputs.error = error;\n  Outputs.Failure();\n}\n"},"ports":[{"name":"in-URL","displayName":"URL","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-QRCodeSize","displayName":"QRCodeSize","plug":"input","type":"*","group":"Inputs","index":5},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":7},{"name":"out-QRCodeImage","displayName":"QRCodeImage","plug":"output","type":"*","group":"Outputs","index":8},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":9}],"children":[]},{"id":"802461d2-30ef-67bc-85a7-ab3c26f1b9d7","type":"JavaScriptFunction","parameters":{"functionScript":"const url = Inputs.URL || '';\nif (!url) throw new Error('Invalid URL');\n\ntry {\n  const encodedURL = encodeURIComponent(url);\n  Outputs.EncodedURL = encodedURL;\n  Outputs.Success();\n} catch (error) {\n  Outputs.error = error;\n  Outputs.Failure();\n}\n"},"ports":[{"name":"in-URL","displayName":"URL","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-EncodedURL","displayName":"EncodedURL","plug":"output","type":"*","group":"Outputs","index":7},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":8}],"children":[]},{"id":"6911831b-083c-9e2a-1eeb-58392225ef6d","type":"JavaScriptFunction","parameters":{"functionScript":"const title = Inputs.title || '';\nif (!title) throw new Error('Invalid title');\n\ntry {\n  const encodedTitle = encodeURIComponent(title);\n  Outputs.EncodedTitle = encodedTitle;\n  Outputs.Success();\n} catch (error) {\n  Outputs.error = error;\n  Outputs.Failure();\n}\n"},"ports":[{"name":"in-title","displayName":"title","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-EncodedTitle","displayName":"EncodedTitle","plug":"output","type":"*","group":"Outputs","index":7},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":8}],"children":[]},{"id":"92f78365-f1a6-65b4-b365-37c6a0ff70f3","type":"String","parameters":{"value":"Check out my Tagiser label"},"ports":[],"children":[]}],"connections":[{"sourceId":"e08b72b9-90e3-f1b3-7828-1c5c9367250e","sourcePort":"label","targetId":"229ea913-e8bf-2221-ab77-759a6b9abacb","targetPort":"modelId"},{"sourceId":"88754148-b72c-f598-279c-27c35b684a0c","sourcePort":"clicked","targetId":"6ac1f2be-1ecf-a9da-bd51-04b7b4970919","targetPort":"close"},{"sourceId":"229ea913-e8bf-2221-ab77-759a6b9abacb","sourcePort":"prop-aiImage","targetId":"3d72c193-90d2-40c8-d810-c3d080eecb04","targetPort":"file"},{"sourceId":"3d72c193-90d2-40c8-d810-c3d080eecb04","sourcePort":"url","targetId":"350849be-ac52-f1e0-64b4-e80063ceda7c","targetPort":"in-URL"},{"sourceId":"350849be-ac52-f1e0-64b4-e80063ceda7c","sourcePort":"out-QRCodeImage","targetId":"2e40e29c-ac36-0409-dc30-5e380ad6e876","targetPort":"src"},{"sourceId":"3d72c193-90d2-40c8-d810-c3d080eecb04","sourcePort":"url","targetId":"802461d2-30ef-67bc-85a7-ab3c26f1b9d7","targetPort":"in-URL"},{"sourceId":"802461d2-30ef-67bc-85a7-ab3c26f1b9d7","sourcePort":"out-EncodedURL","targetId":"9d24a707-1b7d-5255-d3b1-bb692b4d5cd6","targetPort":"prop-urlEncoded"},{"sourceId":"6911831b-083c-9e2a-1eeb-58392225ef6d","sourcePort":"out-EncodedTitle","targetId":"9d24a707-1b7d-5255-d3b1-bb692b4d5cd6","targetPort":"prop-titleEncoded"},{"sourceId":"92f78365-f1a6-65b4-b365-37c6a0ff70f3","sourcePort":"savedValue","targetId":"6911831b-083c-9e2a-1eeb-58392225ef6d","targetPort":"in-title"}],"ports":[{"name":"label","type":{"name":"string","allowConnectionsOnly":true},"group":"General","plug":"input","index":1}],"roots":["b242b89b-ca98-2c92-ac33-a5d901097908"]},{"name":"/Main/n8n get AI image","nodes":[{"id":"d913bb90-36a3-2cc9-57b7-1f003e074f74","type":"NewModel","parameters":{"type-email":"string","type-rootDomain":"string","properties":"theme,userId","type-someString":"string","type-someObject":"object","type-someInteger":"number","type-theme":"string","type-userId":"string"},"ports":[],"children":[]},{"id":"6c7f3e49-4079-8955-4d08-57cdc87771d3","type":"/#Global logic components/n8n/n8n core component","parameters":{"query type":"POST","n8n webhook id":"2e86700a-1f62-48e6-96ca-20b721342578","test webhook":false,"n8n root domain":"https://tagiser-n8n.simple-ricks-low-code-hosting.com"},"ports":[],"children":[]},{"id":"665686b2-d8e0-4921-cac5-790806b0289a","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"ea2a5097-7230-20fb-66bf-69ba4331ad5a","type":"Component Outputs","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"d913bb90-36a3-2cc9-57b7-1f003e074f74","sourcePort":"id","targetId":"6c7f3e49-4079-8955-4d08-57cdc87771d3","targetPort":"inputObject"},{"sourceId":"d913bb90-36a3-2cc9-57b7-1f003e074f74","sourcePort":"created","targetId":"6c7f3e49-4079-8955-4d08-57cdc87771d3","targetPort":"Run"},{"sourceId":"665686b2-d8e0-4921-cac5-790806b0289a","sourcePort":"Do","targetId":"d913bb90-36a3-2cc9-57b7-1f003e074f74","targetPort":"new"},{"sourceId":"6c7f3e49-4079-8955-4d08-57cdc87771d3","sourcePort":"Success","targetId":"ea2a5097-7230-20fb-66bf-69ba4331ad5a","targetPort":"Success"},{"sourceId":"6c7f3e49-4079-8955-4d08-57cdc87771d3","sourcePort":"Failed","targetId":"ea2a5097-7230-20fb-66bf-69ba4331ad5a","targetPort":"Failed"},{"sourceId":"6c7f3e49-4079-8955-4d08-57cdc87771d3","sourcePort":"response","targetId":"ea2a5097-7230-20fb-66bf-69ba4331ad5a","targetPort":"response"},{"sourceId":"6c7f3e49-4079-8955-4d08-57cdc87771d3","sourcePort":"error","targetId":"ea2a5097-7230-20fb-66bf-69ba4331ad5a","targetPort":"error"},{"sourceId":"665686b2-d8e0-4921-cac5-790806b0289a","sourcePort":"theme","targetId":"d913bb90-36a3-2cc9-57b7-1f003e074f74","targetPort":"prop-theme"},{"sourceId":"665686b2-d8e0-4921-cac5-790806b0289a","sourcePort":"userId","targetId":"d913bb90-36a3-2cc9-57b7-1f003e074f74","targetPort":"prop-userId"}],"ports":[{"name":"response","type":"*","plug":"output","index":1},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":1},{"name":"error","type":"*","plug":"output","index":2},{"name":"theme","type":{"name":"string"},"group":"Property Values","plug":"input","index":2},{"name":"Success","type":"signal","plug":"output","index":3},{"name":"userId","type":{"name":"string"},"group":"Property Values","plug":"input","index":3},{"name":"Failed","type":"signal","plug":"output","index":4}],"roots":[]},{"name":"/Main/Loading popup","nodes":[{"id":"d58119cb-d409-edd4-b29d-6248447fa67c","type":"Group","parameters":{"position":"relative","backgroundColor":"#00000099","zIndex":2},"ports":[],"children":[{"id":"63f2a4f1-135a-e9dc-03e9-7f30960f2589","type":"Group","parameters":{"width":{"value":300,"unit":"px"},"height":{"value":300,"unit":"px"},"position":"absolute","alignY":"center","alignX":"center"},"ports":[],"children":[{"id":"a1b61ee2-dfef-69dd-eedc-8fe82149be5b","type":"Lottie","parameters":{"path":"assets/robot-lottie.json","loop":true,"renderer":"svg"},"ports":[],"children":[]},{"id":"e21d0843-498f-b347-2105-c2e6b19c75a5","type":"Text","parameters":{"text":"Creating a unique label just for you! Please wait...","textStyle":"Title Medium","textAlignX":"center","fontFamily":"fonts/Fredoka/static/Fredoka-Regular.ttf","fontSize":{"value":26,"unit":"px"},"color":"Primary Light","marginTop":{"value":-40,"unit":"px"}},"ports":[],"children":[]}]}]},{"id":"b2b673bc-db05-109e-1f56-59cb7d68190c","type":"NavigationClosePopup","parameters":{},"ports":[],"children":[]},{"id":"6cdde0ad-4908-7da3-c7bd-f03ed917472c","type":"Event Receiver","parameters":{"channelName":"aiComplete"},"ports":[],"children":[]}],"connections":[{"sourceId":"6cdde0ad-4908-7da3-c7bd-f03ed917472c","sourcePort":"eventReceived","targetId":"b2b673bc-db05-109e-1f56-59cb7d68190c","targetPort":"close"}],"ports":[],"roots":["d58119cb-d409-edd4-b29d-6248447fa67c"]}]